# BlenderAddon-MizoresCustomExporter
## ◆概要

- 特定のオブジェクトをエクスポート対象から除外
- 特定のオブジェクトだけは非表示になっているときでも絶対にエクスポートする
- （同作者の別アドオンとの連携機能）エクスポート時だけモディファイアを適用
- （同作者の別アドオンとの連携機能）エクスポート時だけオブジェクトを結合
- （同作者の別アドオンとの連携機能）エクスポート時だけシェイプキーを左右分割

といった機能を持ったアドオンです。
現在はfbx形式のエクスポートのみに対応しています。


## ◆はじめに
このデータは、3Dモデリングソフト Blender 用のアドオンです。

↓以下のBlenderバージョンで動作確認済みです。
3.6.4

※   
Blender 2.8～であれば上記以外のバージョンでも導入できますが、動作未確認です。  
何らかの不具合が発生する可能性があるため、データのバックアップをとってから使用することを推奨します。


## ◆File → Export → Mizores Custom Exporter (.fbx)
オブジェクトをfbxとしてエクスポートします。

エクスポート処理そのものはBlender標準の内部処理を呼び出しているため、
出力フォーマットの差異などは生じないと思われます。

基本的にはBlender標準のfbxエクスポートと同じことができるようになっています。

## ◆エクスポートの追加機能
### ◇オブジェクトのプロパティによるエクスポート処理の制御
各種プロパティは  
`オブジェクトモードの右クリックメニュー > Mizore's Custom Exporter`  
から割り当て／解除ができます。


- AlwaysExport: このプロパティが有効なオブジェクトは、オブジェクトが非表示になっていてもエクスポートされます。

- DontExport: このプロパティが有効なオブジェクトはエクスポートされません。

- ResetPoseWhenExport: このプロパティが有効なアーマチュアはエクスポート時にポーズがリセットされます。
- ResetShapekeysWhenExport: このプロパティが有効なオブジェクトはエクスポート時にシェイプキーがリセットされます。
- MoveToOriginWhenExport: このプロパティが有効なオブジェクトはエクスポート時に原点に移動します。
- ApplyLocationsWhenExport: このプロパティが有効なオブジェクトはエクスポート時に位置を適用します。
- ApplyRotationsWhenExport: このプロパティが有効なオブジェクトはエクスポート時に回転を適用します。
- ApplyScalesWhenExport: このプロパティが有効なオブジェクトはエクスポート時にスケールを適用します。
- AlwaysResetShapekeys: このプロパティが有効なオブジェクトはエクスポート時にシェイプキーが0にリセットされます。

## ◇エクスポート対象オブジェクトの設定
### ・Only Root Collections

### ・Selected Objects (Include Children)
通常のSelected Objectsは選択中のオブジェクトしかエクスポートされませんが、この項目を有効にすることで選択中オブジェクトの子階層以下にあるオブジェクトもエクスポートされるようになります。

#### ・Active Collections (Include Children)
通常のActive Collectionsはアクティブなコレクションに属しているオブジェクトしかエクスポートされませんが、この項目を有効にすることでコレクションに属するオブジェクトの子オブジェクトもエクスポートされるようになります。

## ・エクスポート設定
エクスポート設定メニューは標準のfbxエクスポート（io_scene_fbx）を一部改変して使用しています。  

また、一部の初期設定を変更しています。
（このアドオン独自の変更であり、標準のエクスポートの設定には影響しません）

### ・標準のfbxエクスポートと初期設定が異なる項目
- Apply Scalings: デフォルト値をFBX Units Scaleに変更
- Apply Transform: デフォルト値をTrueに変更
- Object Types: デフォルト値を{Armature, Mesh}に変更
- Batch Own Dir: デフォルト値をFalseに変更

### ・設定項目の保存
各種項目の設定状態はblendファイルに保存され、次回以降のエクスポート時に引き継がれます。

アドオン連携機能でオブジェクトの結合などの操作が行われた場合でも、
エクスポート後には処理前の状態が復元されます。
（もしエクスポート後にオブジェクトが増えたり消えたりしていたら不具合です）


## ◆アドオン連携機能

### [Addon]AutoMerge
この連携機能を使うには、同作者の別アドオン“Auto Merge”を導入する必要があります。
（ https://sleetcatshop.booth.pm/items/1166452 ）

コレクション“MergeGroup”に属するものに対し、
それぞれの子階層以下にあるオブジェクトを結合した上でエクスポートします。

連携機能を有効にすることにより、
```
ミラーを付けたまま編集  
　　　　　↓  
エクスポートのときだけミラー適用（自動）  
　　　　　↓  
シェイプキーを自動で左右分割  
　　　　　↓  
エクスポート後は元通り！  
```
ということもできるようになります。


### ・[Addon]ShapeKeysUtil

この連携機能を使うには、同作者の別アドオン“ShapeKeys Util”を導入する必要があります。
（ https://sleetcatshop.booth.pm/items/1224307 ）

連携機能を有効にすることにより、
シェイプキーをもつオブジェクトのモディファイアを適用してエクスポートできます。

※ シェイプキーをもつオブジェクトのモディファイアを適用は“AutoMerge”アドオンの“ShapeKeysUtil”連携機能を介して行われるため、
オブジェクト結合処理が必要ない場合でも“AutoMerge”連携を有効にし、オブジェクトを“MergeGroup”に入れる必要があります。
（モディファイアを適用したいけど子オブジェクトが結合されるのは嫌という場合もありそうなので対応を検討中）

また、エクスポート機能の使用時にシェイプキーの左右分割を行うことができます。
（例：SmileシェイプキーをSmile_leftとSmile_rightという左右別々のシェイプキーに分割）

これにより、
```
ミラーを付けたまま編集
　　　　　↓
エクスポートのときだけミラー適用（自動）
　　　　　↓
シェイプキーを自動で左右分割
　　　　　↓
エクスポート後は元通り！
```
ということもできるようになります。

※    
シェイプキーを持つオブジェクトのモディファイア適用処理には時間がかかるため、エクスポート完了までの所要時間が長くなります。


# ◆注意◆

※
マージする際、Armatureを除く全てのモディファイアは適用されます。  
ただし、レンダリング対象でないモディファイア（モディファイア一覧でカメラアイコンが押されていないもの）は適用せず無視されます。  

※
同作者の別アドオン“ShapeKeys Util”との連携機能が無効になっている場合、シェイプキーをもつオブジェクトはモディファイアを無視してマージ処理を行います。  
そのため、意図しない状態のオブジェクトが出力される可能性があります。  

シェイプキーを含まない他のオブジェクトは通常通りにモディファイア適用・マージを行います。  


## ◆不具合・エラーが起きた時
このアドオンの機能はBlender標準のAPIを使って作成しているため、
何らかの不具合が発生した場合には
すぐに Undo（Ctrl+Z） すれば機能使用前の状態に復元できます。

また、以下の連絡先に不具合発生時の状況を送っていただけると
修正の手助けになります。


## ◆連絡先
不具合報告や要望、感想などありましたらこちらにどうぞ。

修正・実装が可能と思われるものに関しては着手を検討しますが、
多忙や技術的問題などの理由により対応できない場合があります。
予めご了承ください。

Twitter：猫柳みぞれ　https://twitter.com/sleetcat123
